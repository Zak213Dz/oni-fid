<script>
  const form = document.getElementById("inscription-form");

  form.addEventListener("submit", function(e) {
    e.preventDefault();

    const formData = new FormData(form);
    const params = new URLSearchParams();

    for (const pair of formData.entries()) {
      params.append(pair[0], pair[1]);
    }

    fetch("https://script.google.com/macros/s/AKfycbxVCSKg4Qmqam0MD3at6QvRMB0k1TFPfPGBY1DWL45Fit0mbkYusyXVgRNwWI7nNqXD3w/exec", {
      method: "POST",
      body: params
    })
    .then(response => response.text())
    .then(result => {
      if (!result.includes("|")) throw new Error("Réponse mal formée");
      const [id, token] = result.split("|");
      window.location.href = `https://zak213dz.github.io/oni-fid/carte.html?id=${id}&token=${token}`;
    })
    .catch(error => {
      alert("Erreur : " + error.message);
    });
  });
</script>
