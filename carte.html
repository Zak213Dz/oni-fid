<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Carte de fidélité</title>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
</head>
<body>
  <div id="carte">Chargement de la carte...</div>

  <script>
    const id = new URLSearchParams(window.location.search).get("id");
    const CSV_URL = "https://docs.google.com/spreadsheets/d/1s0Vi2JkXSCcnJ7itwtheTw9cdf35LxWbQ3IZxu9lXE/gviz/tq?tqx=out:csv&sheet=Réponses%20Formulaire";

    Papa.parse(CSV_URL, {
      download: true,
      header: true,
      complete: function(results) {
        const data = results.data;
        const client = data.find(row => row["Clé"]?.trim() === id);

        if (client) {
          document.getElementById("carte").innerHTML = `
            <h2>Carte de fidélité</h2>
            <p><strong>${client["Prénom"]} ${client["Nom"]}</strong></p>
            <p>ID : ${client["ID Client"]}</p>
            <p>Points : ${client["Total points actuel"]}</p>
            <p>Menus offerts : ${client["Menus offerts"]}</p>
          `;
        } else {
          document.getElementById("carte").innerHTML = "<p>Carte introuvable ou lien invalide.</p>";
        }
      }
    });
  </script>
</body>
</html>
