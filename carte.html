<script>
const urlParams = new URLSearchParams(window.location.search);
const clientId = urlParams.get('id');

fetch("https://docs.google.com/spreadsheets/d/e/2PACX-1vQ0J_iakEUYtcP-RPRlVNTBvlPPJ8mqsz7hnPWFSNl-9TihVe9pYwH00kroVBIEF2JrqkqtYZWLmUos/pub?gid=1721109896&single=true&output=csv")
  .then(res => res.text())
  .then(csv => {
    const rows = csv.split("\n").map(r => r.split(","));
    const headers = rows.shift();
    const idIndex = headers.indexOf("ID Client");

    const row = rows.find(r => r[idIndex] === clientId);
    if (!row) {
      document.body.innerHTML = "<h2 style='color:white'>Client introuvable</h2>";
      return;
    }

    // Lire les bonnes colonnes fixes par position
    const nom = row[1];
    const prenom = row[2];
    const points = parseInt(row[5]) || 0;
    const montant = parseFloat(row[6].replace(",", ".")) || 0;
    const menus = parseInt(row[8]) || 0;

    document.getElementById("id").textContent = clientId;
    document.getElementById("nom").textContent = nom;
    document.getElementById("prenom").textContent = prenom;
    document.getElementById("montant").textContent = montant.toFixed(2);
    document.getElementById("menus").textContent = menus;

    const casesContainer = document.getElementById("cases");
    for (let i = 0; i < 10; i++) {
      const div = document.createElement("div");
      div.className = "case";
      if (i < points) {
        const barre = document.createElement("div");
        barre.className = "barre";
        div.appendChild(barre);
      }
      casesContainer.appendChild(div);
    }

    document.getElementById("qr").src = `https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=https://zak213dz.github.io/oni-fid/carte.html?id=${clientId}`;
  })
  .catch(error => {
    document.body.innerHTML = "<h2 style='color:white'>Erreur de chargement</h2>";
    console.error(error);
  });
</script>
